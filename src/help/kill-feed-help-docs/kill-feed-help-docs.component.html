<div class="center-container">
  <h1>How to</h1>
  <p>This guide will provide a rough how-to on how to use the Kill Log overlay</p>
  <mat-accordion togglePosition="before">
    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>Prerequisites</mat-panel-title>
      </mat-expansion-panel-header>
      <mat-list>
        <mat-list-item><a mat-button color="accent" href="https://streamer.bot/">Streamer.bot</a> (<a mat-button color="accent" href="https://streamer.bot/api/releases/streamer.bot/latest/download">direct download</a>)</mat-list-item>
      </mat-list>
    </mat-expansion-panel>
    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>Installation</mat-panel-title>
      </mat-expansion-panel-header>
      <p>Create a new Overlay in StreamElements, add a new Static / Custom -> Custom widget. Copy paste the following files into their respective tabs</p>
      <mat-list>
        <mat-list-item><app-content-url url="kill-feed/overlay.html">overlay.html</app-content-url></mat-list-item>
        <mat-list-item><app-content-url url="kill-feed/overlay.css">overlay.css</app-content-url></mat-list-item>
        <mat-list-item><app-content-url url="kill-feed/overlay.js">overlay.js</app-content-url></mat-list-item>
        <mat-list-item><app-content-url url="kill-feed/fields.json">fields.json</app-content-url></mat-list-item>
        <mat-list-item><app-content-url url="kill-feed/data.json">data.json</app-content-url></mat-list-item>
      </mat-list>
    </mat-expansion-panel>
    <mat-expansion-panel expanded>
      <mat-expansion-panel-header>
        <mat-panel-title>Streamer.bot Setup</mat-panel-title>
      </mat-expansion-panel-header>
      <mat-accordion togglePosition="before">
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>Import actions into Streamer.bot</mat-panel-title>
          </mat-expansion-panel-header>
          <mat-list>
            <mat-list-item>
              <p>
                Copy contents of <app-content-url url="kill-feed/streamerbot/streamerbot.sb">streamerbot.sb</app-content-url> to clipboard.
              </p>
              <p>
                For transparency, CS scripts can be <app-content-url url="https://github.com/BlackholeDevice/StreamElementsOverlays/tree/main/public/kill-feed/cs" action="open">viewed in GitHub</app-content-url>.
              </p>
            </mat-list-item>
            <mat-list-item>Launch Streamer.bot and click the button that says "Import"</mat-list-item>
            <mat-list-item>In the field labeled "Import String" paste the previously copied file contents and click the "Import" button</mat-list-item>
          </mat-list>
        </mat-expansion-panel>
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>Configure file tails</mat-panel-title>
          </mat-expansion-panel-header>
          <mat-list>
            <mat-list-item>Navigate to Settings tab</mat-list-item>
            <mat-list-item>Navigate to the File Tails sub-tab</mat-list-item>
            <mat-list-item>Right click in the white section and click "Add"</mat-list-item>
            <mat-list-item>
              Set up the file tail
              <mat-list>
                <mat-list-item>Enabled: true</mat-list-item>
                <mat-list-item>Name: Any name you want. I recommend including the release branch in the name. I.e LIVE</mat-list-item>
                <mat-list-item>File: File path to Game.log file. The file path is /path/to/game/Game.log. I.e C:\Program Files (x86)\Roberts Space Industries\StarCitizen\LIVE\Game.log</mat-list-item>
              </mat-list>
            </mat-list-item>
            <mat-list-item>
              Attach newly created file tail to all actions
              <mat-list>
                <mat-list-item>Navigate back to Actions tab</mat-list-item>
                <mat-list-item>
                  For each of the following actions: RestartTails, Start Tails, Stop Tails, Corpse marker
                  <mat-list>
                    <mat-list-item>Single click on action in the left-hand list</mat-list-item>
                    <mat-list-item>Under triggers (top right), on each tail, double click and select newly created tail. If no tail trigger exists, skip</mat-list-item>
                    <mat-list-item>Under sub-actions (bottom right), on each tail, double click and select newly created tail. If no tail sub-action exists, skip</mat-list-item>
                  </mat-list>
                </mat-list-item>
              </mat-list>
            </mat-list-item>
          </mat-list>
        </mat-expansion-panel>
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>Configure file watchers</mat-panel-title>
          </mat-expansion-panel-header>
          <mat-list>
            <mat-list-item>Navigate to Settings tab</mat-list-item>
            <mat-list-item>Navigate to the File/Folder Watchers sub-tab</mat-list-item>
            <mat-list-item>Right click in the white section and click "Add"</mat-list-item>
            <mat-list-item>
              Set up the file watcher
              <mat-list>
                <mat-list-item>Enabled: checked</mat-list-item>
                <mat-list-item>As JSON: unchecked</mat-list-item>
                <mat-list-item>Include Subdirectories: unchecked</mat-list-item>
                <mat-list-item>Folder: Path to game folder. I.e C:\Program Files (x86)\Roberts Space Industries\StarCitizen\LIVE</mat-list-item>
                <mat-list-item>Filter: Game.log</mat-list-item>
              </mat-list>
            </mat-list-item>
            <mat-list-item>
              Attach newly created watcher to Game Launch Log Fix action
              <mat-list>
                <mat-list-item>Single click on Game Launch Log Fix action in the left-hand list</mat-list-item>
                <mat-list-item>Under triggers (top right), double click each trigger and select newly created watcher</mat-list-item>
              </mat-list>
            </mat-list-item>
          </mat-list>
        </mat-expansion-panel>
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>Configure Streamer.bot to accept websocket connections</mat-panel-title>
          </mat-expansion-panel-header>
          <mat-list>
            <mat-list-item>Navigate to Servers/Clients tab</mat-list-item>
            <mat-list-item>Navigate to Websocket Server tab (selected by default)</mat-list-item>
            <mat-list-item>
              Verify settings are correct
              <mat-list>
                <mat-list-item>Auto Start: Recommend to check this</mat-list-item>
                <mat-list-item>
                  Address: IP address to listen on. If you stream and game on the same PC, this can stay as 127.0.0.1. Otherwise, this will need to change.
                  If you use a separate game and stream PC, you will need to run Streamer.bot on the GAME PC. Determine your internal IP address and use that here.
                  You can also use "0.0.0.0" to listen to all connections, but this is less recommended.
                </mat-list-item>
                <mat-list-item>Port: Can stay 8080 in most cases. If you already have processes listening to port 8080, you can select another. It is recommend to use numbers greater than 8080. Port number must also be less than 65535</mat-list-item>
                <mat-list-item>Endpoint: Can be left as /</mat-list-item>
              </mat-list>
            </mat-list-item>
          </mat-list>
        </mat-expansion-panel>
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>Configure SC Tool integration (Optional)</mat-panel-title>
          </mat-expansion-panel-header>
          <p>
            SC Tool integration can be configured by specifying your API key. Your API key can be obtained from the SC Tool website.
          </p>
          <p>
            Requires discord login. API keys are discord server specific.
            Be sure to select the correct member discord to generate an API key.
          </p>
          <mat-list>
            <mat-list-item>Log in to <app-content-url url="https://starcitizentool.com" action="open">SCTool website</app-content-url></mat-list-item>
            <mat-list-item>Select your discord server</mat-list-item>
            <mat-list-item>Navigate to Kill Tracker, then select "Manage API Keys" from the top left. <app-content-url url="https://starcitizentool.com/kills/manage_api_keys" action="open">Or click here.</app-content-url> </mat-list-item>
            <mat-list-item>If you are an admin in the selected discord: You will have to repeat the previous steps a couple times.</mat-list-item>
            <mat-list-item>Click "Generate New API Key" at the top of the screen. Note: Your key will NOT be shown again. Make sure you save it</mat-list-item>
            <mat-list-item>In StreamerBot, click "Variables" at the top and add a new variable called "SCTOOLS_API_KEY" and paste your API Key</mat-list-item>
          </mat-list>
        </mat-expansion-panel>
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>Configure Twitch Integration (Optional)</mat-panel-title>
          </mat-expansion-panel-header>
          <p>Twitch Integration can be configured to automatically generate clips and post those clip links in chat. Clip links will automatically be used to in events sent to SC Tool. Limitation: Automatic clip generation currently depends on SC Tool integration</p>
          <mat-list>
            <mat-list-item>Navigate to "Platforms", then "Twitch" tab.</mat-list-item>
            <mat-list-item>Log into broadcaster account (the account you stream under)</mat-list-item>
            <mat-list-item>(Optional) Log into your bot account (Only needed if you use a different bot account from your twitch account).</mat-list-item>
            <mat-list-item><a mat-stroked-button color="accent" (click)="obs.toggle()"> Connect OBS to Streamerbot</a></mat-list-item>
          </mat-list>
        </mat-expansion-panel>
        <mat-expansion-panel #obs>
          <mat-expansion-panel-header>
            <mat-panel-title>Configure OBS Integration (Required if using Twitch Integration)</mat-panel-title>
          </mat-expansion-panel-header>
          <p>OBS integration is used to automatically determine if you are streaming in order to automatically generate kill clips. Requires OBS Studio v28+</p>
          <mat-list>
            <mat-list-item>Open OBS Studio</mat-list-item>
            <mat-list-item>Navigate to Tools -> Websocket Server Settings</mat-list-item>
            <mat-list-item>Check "Enable WebSocket server"</mat-list-item>
            <mat-list-item>Click "Generate Password"</mat-list-item>
            <mat-list-item>Click "Show Connection Info"</mat-list-item>
            <mat-list-item>In Streamerbot, navigate to "Stream Apps" -> OBS</mat-list-item>
            <mat-list-item>
              Right click the list and click "Add"
            <mat-list>
              <mat-list-item>Name: Can be anything</mat-list-item>
              <mat-list-item>Version: leave as is</mat-list-item>
              <mat-list-item>Host: IP address of the computer running OBS. This will usually be 127.0.0.1 if OBS and Streamerbot are on the same PC.</mat-list-item>
              <mat-list-item>Port: Port number from OBS connection info window</mat-list-item>
              <mat-list-item>Password: Password from OBS connection info window</mat-list-item>
              <mat-list-item>Auto Connect on Startup: Check this</mat-list-item>
              <mat-list-item>Reconnect on Disconnect: Check this</mat-list-item>
              <mat-list-item>Retry Interval: Can leave as is</mat-list-item>
            </mat-list>
            </mat-list-item>

          </mat-list>
        </mat-expansion-panel>
        <mat-expansion-panel>
          <mat-expansion-panel-header>Configure Discord Integration (Optional)</mat-expansion-panel-header>
          <p>Discord integration requires you to have access to configure Webhooks. This connection is only used to automatically post clips to discord. Requires Twitch Integration</p>
          <mat-list>
            <mat-list-item>In discord: Navigate to channel you want clips posted to (or create a new one).</mat-list-item>
            <mat-list-item>Open channel settings</mat-list-item>
            <mat-list-item>Navigate to Integrations > Webhooks > New Webhook</mat-list-item>
            <mat-list-item>Webhook name and icon can be freely customized as needed</mat-list-item>
            <mat-list-item>Click webhook to expand and click "Copy Webhook URL"</mat-list-item>
            <mat-list-item>In streamerbot find action called "Chat - Send Message"</mat-list-item>
            <mat-list-item>
              Under sub actions, double click on "Discord Basic Webhook"
              <mat-list>
                <mat-list-item>Webhook name: Can be anything</mat-list-item>
                <mat-list-item>Username: Override the webhook name in discord. This name is what will show in discord chat messagea</mat-list-item>
                <mat-list-item>
                  Content: Message content. By default, this message will be generated by other actions, but can be customized as needed. Variables can be used.
                </mat-list-item>
              </mat-list>
            </mat-list-item>
          </mat-list>
        </mat-expansion-panel>

        <mat-expansion-panel expanded>
          <mat-expansion-panel-header>
            <mat-panel-title>Customization</mat-panel-title>
          </mat-expansion-panel-header>
          <p>A couple options are available for customizing messages.</p>
          <mat-list>
            <mat-list-item>
              Twitch clip message: Under action "Twitch - Create clip" action, double click on the sub action 'Set argument %message%...' and change accordingly.
              Note: Message should NOT be star citizen specific because this will also integrate with !clip command
            </mat-list-item>
            <mat-list-item>
              Kill messages: Under action "SC Actor Death Clip Message", double click on the sub action 'Set argument %message%...' and change accordingly.

              <mat-list>
                <mat-list-item><code>%victim%</code>: Victim name</mat-list-item>
                <mat-list-item><code>%attacker%</code>: Attacker name</mat-list-item>
                <mat-list-item><code>%zone%</code>: Victim location</mat-list-item>
                <mat-list-item><code>%weapon%</code>: Weapon victim was killed with</mat-list-item>
                <mat-list-item><code>%damageType%</code>: Type of damage that killed the victim</mat-list-item>
              </mat-list>
              <p>
                Note: It is not necessary to add <code>%createClipUrl%</code> to the message because this is already added by other actions.
                Other variables are available but are not documented as they are not user friendly.
              </p>
            </mat-list-item>
          </mat-list>
        </mat-expansion-panel>
      </mat-accordion>
    </mat-expansion-panel>
    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>Overlay Configuration</mat-panel-title>
      </mat-expansion-panel-header>
      <mat-accordion togglePosition="before">
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>Connection</mat-panel-title>
          </mat-expansion-panel-header>
          <mat-list>
            <mat-list-item>Socket Mode: How connection should be made for displaying the kill feed. Default: Streamer.bot Client</mat-list-item>
            <mat-list>
              <mat-list-item>Streamer.bot Client: Connect to local Streamer.bot instance using the provided connection info</mat-list-item>
              <mat-list-item>Debug: Debug the overlay using dummy data. No socket connection will be made. Data will be generated at a rate of 55% of fade time to ensure multiple events can be tested at once.</mat-list-item>
            </mat-list>
            <mat-list-item>Web socket host: Hostname of the websocket server. See Streamer.bot setup instructions. Default: 127.0.0.1</mat-list-item>
            <mat-list-item>Web socket port: Port of the websocket server. See Streamer.bot setup instructions. Default: 8080</mat-list-item>
            <mat-list-item>Web socket endpoint: Websocket endpoint. See Streamer.bot setup instructions. Default /</mat-list-item>
          </mat-list>
        </mat-expansion-panel>
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>Options</mat-panel-title>
          </mat-expansion-panel-header>
          <mat-list>
            <mat-list-item>Show NPCs: Whether NPCs should be shown by the overlay. Default: checked</mat-list-item>
            <mat-list-item>Fade Time: How long each event should be shown (in seconds)</mat-list-item>
          </mat-list>
        </mat-expansion-panel>
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>Styles</mat-panel-title>
          </mat-expansion-panel-header>
          <mat-list>
            <mat-list-item>Font: Font to use</mat-list-item>
            <mat-list-item>Font color: Font color</mat-list-item>
            <mat-list-item>Font size: Font size</mat-list-item>
            <mat-list-item>Outline color: Outline color, if present</mat-list-item>
            <mat-list-item>Outline thickness: Outline thickness, if present</mat-list-item>
            <mat-list-item>Alignment: Determines whether events will be left aligned or right align</mat-list-item>
            <mat-list-item>Line spacing: Spacing between events</mat-list-item>
            <mat-list-item>Letter spacing: Text kerning</mat-list-item>
          </mat-list>
        </mat-expansion-panel>
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>Kills</mat-panel-title>
          </mat-expansion-panel-header>
          <mat-list>
            <mat-list-item>Kill icon: Image to be shown. Icon MUST be present within death message otherwise it will not be shown</mat-list-item>
            <mat-list-item>Death message: Message to be shown for each event. Placeholders can be used in place of the following:</mat-list-item>
              <mat-list>
                <mat-list-item><p><code>{{'{'}}attacker{{'}'}}</code>: The name of the player that got the killing blow</p></mat-list-item>
                <mat-list-item><p><code>{{'{'}}victim{{'}'}}</code>: The name of the player killed</p></mat-list-item>
                <mat-list-item><p><code>{{'{'}}using{{'}'}}</code>: The weapon used in the killing blow. Note: This is not a user-friendly name.</p></mat-list-item>
                <mat-list-item><p><code>{{'{'}}damageType{{'}'}}</code>: The type of damage in the killing blow. Note: This is not a user-friendly name.</p></mat-list-item>
                <mat-list-item><p><code>{{'{'}}zone{{'}'}}</code>: The container the victim was in at time of death. Note: This is not a user-friendly name.</p></mat-list-item>
                <mat-list-item><p><code>{{'{'}}icon{{'}'}}</code>: The icon specified in the kill icon option</p></mat-list-item>
              </mat-list>
          </mat-list>
        </mat-expansion-panel>
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>Notes</mat-panel-title>
          </mat-expansion-panel-header>
          <mat-list>
            <mat-list-item>Ballistic kills and Laser kills apply to kills via Ballistic and energy FPS weapons, not ship weapons</mat-list-item>
            <mat-list-item>Icons and messages specified under "Other Kills" will be used as defaults when no other category applies.</mat-list-item>
          </mat-list>
        </mat-expansion-panel>
      </mat-accordion>
    </mat-expansion-panel>
    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>Streamer View</mat-panel-title>
      </mat-expansion-panel-header>
      <p>
        For convenience, you can use <a mat-button color="accent" href="kill-feed/log.html">log.html</a> as a kill dashboard.
        This will show the same thing as the overlay without the fade time. This way, you can keep a list of deaths always visible.
        This is intended to be a behind-the-scenes view not shown on stream
      </p>
      <mat-accordion togglePosition="before">
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>Configuration</mat-panel-title>
          </mat-expansion-panel-header>
          <p>This log view uses the default settings as shown in the options of the Streamelements overlay, but provides no UI to change it. To change it, you can append your options to the url.</p>
          <mat-list>
            <mat-list-item>host: Websocket host. Default: 127.0.0.1, example: host=localhost</mat-list-item>
            <mat-list-item>port: Websocket port. Default: 8080, example: port=8081</mat-list-item>
            <mat-list-item>endpoint: Websocket endpoint. Default: /, example: endpoint=/different</mat-list-item>
            <mat-list-item>filter: Limit to only listed users. This option can either be comma separated or repeated to include multiple users. Default: filter=user1,user2 OR filter=user1&filter=user2</mat-list-item>
            <mat-list-item>fields: Change the order of the columns. This option can be either comma separated or repeated. Available columns (case sensitive): time, victim, attacker. Default: time,victim,attacker.</mat-list-item>
          </mat-list>
          <p>Options in the url must be separated by ampersand (&amp;). Options must all be preceded by a '?'. https://blackholedevice.github.io/StreamElementsOverlays/kill-feed/v1/log.html<span class="emphasis">?</span>host=localhost<span class="emphasis">&amp;</span>port=8081<span class="emphasis">&amp;</span>endpoint=/different<span class="emphasis">&amp;</span>filter=user1,user2<span class="emphasis">&amp;</span>filter=user3
          </p>
        </mat-expansion-panel>
      </mat-accordion>
    </mat-expansion-panel>
  </mat-accordion>
</div>
